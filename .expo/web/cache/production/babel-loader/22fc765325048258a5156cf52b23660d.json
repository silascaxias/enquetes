{"ast":null,"code":"var _interopRequireWildcard=require(\"@babel/runtime/helpers/interopRequireWildcard\");var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _react=_interopRequireWildcard(require(\"react\"));var _reactNative=require(\"react-native\");var _reactNativePaper=require(\"react-native-paper\");var strings=_interopRequireWildcard(require(\"./strings\"));var _styles=_interopRequireDefault(require(\"./styles\"));var _styles2=_interopRequireDefault(require(\"./../../resources/styles\"));var _PollVote=require(\"../../actions/PollVote\");var _reactRedux=require(\"react-redux\");var _api=_interopRequireDefault(require(\"../../network/api\"));function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var PollVote=function(_Component){(0,_inherits2.default)(PollVote,_Component);var _super=_createSuper(PollVote);function PollVote(){var _this;(0,_classCallCheck2.default)(this,PollVote);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isLoading:true,selectedID:null};_this.fetchPoll=function _callee(){var response,serverError;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regenerator.default.awrap(_api.default.get(\"/poll/\"+_this.props.selectedID));case 3:response=_context.sent;if(response.ok){_this.props.setPoll(response.data);_this.setState({isLoading:false});}else{_this.setState({isLoading:false});serverError=response.data.error;_reactNative.Alert.alert(serverError!=null?serverError:response.originalError.message);}_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);_this.setState({isLoading:false});_reactNative.Alert.alert(_context.t0.error.toString());case 11:case\"end\":return _context.stop();}}},null,null,[[0,7]],Promise);};_this.sendVote=function _callee2(){var response,serverError;return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(_this.state.selectedID==null){_reactNative.Alert.alert(strings.selectAnOption);}_context2.prev=1;_this.setState({isLoading:true});_context2.next=5;return _regenerator.default.awrap(_api.default.post(\"/poll/\"+_this.props.poll.poll_id+\"/vote\",{option_id:_this.state.selectedID}));case 5:response=_context2.sent;if(response.ok){_this.setState({isLoading:false});_reactNative.Alert.alert(strings.computedVote);_this.props.navigation.navigate('PollList');}else{_this.setState({isLoading:false});serverError=response.data.error;_reactNative.Alert.alert(serverError!=null?serverError:response.originalError.message);}_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);_reactNative.Alert.alert(_context2.t0.error.toString());case 12:case\"end\":return _context2.stop();}}},null,null,[[1,9]],Promise);};_this.renderButton=function(option,index){return _react.default.createElement(_reactNative.View,{style:_styles.default.rowContainer,key:option.option_id},_react.default.createElement(_reactNative.TouchableOpacity,{style:_styles.default.pollOptionButton,onPress:function onPress(){_this.setState({selectedID:option.option_id});}},_react.default.createElement(_reactNativePaper.Text,{style:_styles.default.pollOption},index+1,\". \",option.option_description)),_react.default.createElement(_reactNativePaper.RadioButton,{color:\"#DA552F\",value:option.option_id,status:_this.state.selectedID===option.option_id?'checked':'unchecked'}));};return _this;}(0,_createClass2.default)(PollVote,[{key:\"componentDidMount\",value:function componentDidMount(){this.fetchPoll();}},{key:\"render\",value:function render(){var _this2=this;var options=this.state.isLoading?[]:this.props.poll.options;var poll=this.props.poll;return this.state.isLoading?_react.default.createElement(_reactNative.View,{style:[_styles.default.indicatorContainer,_styles.default.indicatorHorizontal]},_react.default.createElement(_reactNative.ActivityIndicator,{size:\"large\",color:\"#DA552F\"})):_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_reactNative.View,{style:[_styles2.default.defaultBorder,_styles.default.additionalContainer]},_react.default.createElement(_reactNativePaper.Text,{style:_styles.default.pollTitle},poll.poll_description)),_react.default.createElement(_reactNative.ScrollView,{style:[_styles2.default.defaultBorder,_styles.default.additionalContainer]},_react.default.createElement(_reactNativePaper.RadioButton.Group,{value:this.state.selectedID},options.map(function(option,index){return _this2.renderButton(option,index);}))),_react.default.createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){_this2.sendVote();},style:_styles.default.voteButton},_react.default.createElement(_reactNativePaper.Text,{style:_styles.default.voteButtonText},strings.sendVote)));}}]);return PollVote;}(_react.Component);PollVote.navigationOptions={title:strings.title};var mapStateToProps=function mapStateToProps(state){return{selectedID:state.pollVoteReducer.selectedID,poll:state.pollVoteReducer.poll};};var mapStateToDispatch=function mapStateToDispatch(dispatch){return{setPoll:function setPoll(poll){return dispatch((0,_PollVote.setPoll)(poll));}};};var _default=(0,_reactRedux.connect)(mapStateToProps,mapStateToDispatch)(PollVote);exports.default=_default;","map":{"version":3,"sources":["/Users/scaxias/Projetos/Estudos/Enquetes/src/screens/PollVote/index.js"],"names":["PollVote","state","isLoading","selectedID","fetchPoll","api","get","props","response","ok","setPoll","data","setState","serverError","error","Alert","alert","originalError","message","toString","sendVote","strings","selectAnOption","post","poll","poll_id","option_id","computedVote","navigation","navigate","renderButton","option","index","styles","rowContainer","pollOptionButton","pollOption","option_description","options","indicatorContainer","indicatorHorizontal","globalStyles","defaultBorder","additionalContainer","pollTitle","poll_description","map","voteButton","voteButtonText","Component","navigationOptions","title","mapStateToProps","pollVoteReducer","mapStateToDispatch","dispatch"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {\n  Alert,\n  View,\n  ActivityIndicator,\n  TouchableOpacity,\n  ScrollView,\n} from 'react-native';\nimport {Text, RadioButton} from 'react-native-paper';\nimport * as strings from './strings';\n\nimport styles from './styles';\nimport globalStyles from './../../resources/styles';\n\nimport {setPoll} from '../../actions/PollVote';\nimport {connect} from 'react-redux';\nimport api from '../../network/api';\n\nclass PollVote extends Component {\n  static navigationOptions = {\n    title: strings.title,\n  };\n\n  state = {\n    isLoading: true,\n    selectedID: null,\n  };\n\n  fetchPoll = async () => {\n    try {\n      const response = await api.get(`/poll/${this.props.selectedID}`);\n\n      if (response.ok) {\n        this.props.setPoll(response.data);\n        this.setState({isLoading: false});\n      } else {\n        this.setState({isLoading: false});\n        const serverError = response.data.error;\n        Alert.alert(\n          serverError != null ? serverError : response.originalError.message,\n        );\n      }\n    } catch (err) {\n      this.setState({isLoading: false});\n      Alert.alert(err.error.toString());\n    }\n  };\n\n  sendVote = async () => {\n    if (this.state.selectedID == null) {\n      Alert.alert(strings.selectAnOption);\n    }\n\n    try {\n      this.setState({isLoading: true});\n      const response = await api.post(`/poll/${this.props.poll.poll_id}/vote`, {\n        option_id: this.state.selectedID,\n      });\n      if (response.ok) {\n        this.setState({isLoading: false});\n        Alert.alert(strings.computedVote);\n        this.props.navigation.navigate('PollList');\n      } else {\n        this.setState({isLoading: false});\n        const serverError = response.data.error;\n        Alert.alert(\n          serverError != null ? serverError : response.originalError.message,\n        );\n      }\n    } catch (err) {\n      Alert.alert(err.error.toString());\n    }\n  };\n\n  componentDidMount() {\n    this.fetchPoll();\n  }\n\n  renderButton = (option, index) => (\n    <View style={styles.rowContainer} key={option.option_id}>\n      <TouchableOpacity\n        style={styles.pollOptionButton}\n        onPress={() => {\n          this.setState({selectedID: option.option_id});\n        }}>\n        <Text style={styles.pollOption}>\n          {index + 1}. {option.option_description}\n        </Text>\n      </TouchableOpacity>\n      <RadioButton\n        color=\"#DA552F\"\n        value={option.option_id}\n        status={\n          this.state.selectedID === option.option_id ? 'checked' : 'unchecked'\n        }\n      />\n    </View>\n  );\n\n  render() {\n    const options = this.state.isLoading ? [] : this.props.poll.options;\n    const poll = this.props.poll;\n\n    return this.state.isLoading ? (\n      <View style={[styles.indicatorContainer, styles.indicatorHorizontal]}>\n        <ActivityIndicator size=\"large\" color=\"#DA552F\" />\n      </View>\n    ) : (\n      <>\n        <View style={[globalStyles.defaultBorder, styles.additionalContainer]}>\n          <Text style={styles.pollTitle}>{poll.poll_description}</Text>\n        </View>\n        <ScrollView\n          style={[globalStyles.defaultBorder, styles.additionalContainer]}>\n          <RadioButton.Group value={this.state.selectedID}>\n            {options.map((option, index) => this.renderButton(option, index))}\n          </RadioButton.Group>\n        </ScrollView>\n        <TouchableOpacity\n          onPress={() => {\n            this.sendVote();\n          }}\n          style={styles.voteButton}>\n          <Text style={styles.voteButtonText}>{strings.sendVote}</Text>\n        </TouchableOpacity>\n      </>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    selectedID: state.pollVoteReducer.selectedID,\n    poll: state.pollVoteReducer.poll,\n  };\n};\n\nconst mapStateToDispatch = (dispatch) => {\n  return {\n    setPoll: (poll) => dispatch(setPoll(poll)),\n  };\n};\n\nexport default connect(mapStateToProps, mapStateToDispatch)(PollVote);\n"]},"metadata":{},"sourceType":"script"}